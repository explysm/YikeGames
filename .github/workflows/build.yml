jobs:
  build:
    runs-on: ubuntu-latest

    # CRITICAL: Ensures the GITHUB_TOKEN has permission to create a release/tag
    permissions:
      contents: write 

    steps:
      # ... (Steps 1, 2, 3, 4 remain the same: Checkout, Setup Node, Install Deps, Install Wine)

      # 5. Build and package the Electron app (The FIX is here)
      - name: Build and package the Electron app
        run: npm run build -- --linux --win
        env:
          # This token satisfies electron-builder's potential need for signing/notarization
          # or downloading helper binaries.
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }} # Redundant, but safe

      # 6. Create GitHub Release (Use the fixed version from before)
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/heads/main')
        with:
          # The softprops action requires the token to be passed via the 'with' block
          token: ${{ secrets.GITHUB_TOKEN }}
          name: App Build (${{ github.sha }})
          tag_name: build-${{ github.sha }}
          body: This is an automated build from the 'main' branch.
          files: |
            dist/*
