<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Main Screen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="styles/style.css">

<style>
/* --- New CSS for the Commit Toggle --- */
.commit-toggle-btn {
    background-color: #4CAF50; /* Green */
    border: none;
    color: white;
    padding: 8px 16px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 14px;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 4px;
    transition: background-color 0.3s;
}

.commit-toggle-btn:hover {
    background-color: #45a049;
}

.commit-toggle-btn.active {
    background-color: #007bff; /* Blue for active state */
}

.commit-list-container {
    display: none; /* Default state: hidden */
}

.commit-list-container.active {
    display: block; /* Show active container */
}
/* --- END New CSS --- */
</style>

<script type="module">
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAUZZBN9qoM34lsvyEOeK2znSSw6kKMcEE",
      authDomain: "yikegames-website.firebaseapp.com",
      projectId: "yikegames-website",
      storageBucket: "yikegames-website.firebasestorage.app",
      messagingSenderId: "1086586566551",
      appId: "1:1086586566551:web:b64dfc25e6e6ac5a09b6d2",
      measurementId: "G-FXH0D07D86"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    
    // --- Update Check Function for Renderer Process ---
    async function checkForNewRelease() {
        // Only run if the application is running in the Electron environment
        if (typeof window.electronAPI === 'undefined') {
            return;
        }

        const CURRENT_TAG = await window.electronAPI.getCurrentTag();
        const REPO = "explysm/yikegames"; 
        const notificationArea = document.getElementById("update-notification");

        if (CURRENT_TAG === "unknown-tag") return;

        try {
            const response = await fetch(`https://api.github.com/repos/${REPO}/releases/latest`);
            if (!response.ok) throw new Error("GitHub API failed to fetch release.");

            const latestRelease = await response.json();
            const LATEST_TAG = latestRelease.tag_name;

            if (LATEST_TAG !== CURRENT_TAG) {
                notificationArea.style.display = 'block';
                notificationArea.innerHTML = `
                    <p class="warning1" style="color: red; font-weight: bold;">
                        ðŸ“¢ New App Update Available! Your version: ${CURRENT_TAG}, Latest: 
                        <a href="${latestRelease.html_url}" target="_blank">Version ${LATEST_TAG}</a>.
                    </p>`;
            }
        } catch (error) {
            console.error("Error checking for updates:", error);
        }
    }
    // --- END: Update Check Function ---

    onAuthStateChanged(auth, (user) => {
      // ...inside onAuthStateChanged...
      const loginBtnAnchor = document.getElementById("login-register-btn");
      const loginBtnButton = loginBtnAnchor.querySelector('button');

      if (user) {
       if (loginBtnButton) {
        loginBtnButton.textContent = "Account";
        loginBtnAnchor.href = "other/account.html";
       }
      }
    });

    // Call the update check when the script loads
    checkForNewRelease();
</script>
</head>
<body>
    <header>
        <h1>Welcome to the home page!</h1>
        <p class="subtitle">Go to any section using the buttons below</p>
    </header>

    <div class="main-content">
        <div class="left-sidebar">

            <section class="web">
                <a href="https://yike.games">yike.games</a>
                <a href="https://yikegames.itch.io">yikegames.itch.io</a>
                <a href="https://github.com/explysm">github.com/explysm</a>
            </section>
            
            <div class="divider"></div>

            <section class="social-links">
                <a href="https://x.com/AsnCEe">Twitter</a>
                <a href="https://discord.gg/769tuQEUBM">Discord</a>
            </section>
        </div>

        <div class="center-column">
            <section id="update-notification" class="warning" style="display:none; margin-bottom: 15px;"></section>

            <section class="login-container">
                <a id="login-register-btn" href="other/login.html"><button class="btn login-btn">Login / Register</button></a>
            </section>

            <section class="buttons-center">
                <a href="other/games.html"><button class="btn">Games</button></a>
                <a href="other/aboutme.html"><button class="btn">About Me</button></a>
                <a href="other/chat.html"><button class="btn">Global Chat</button></a>
                <a href="other/devlog.html"><button class="btn">Dev Log</button></a>
            </section>
        </div>

        <div class="right-sidebar">
            <section class="updates">
                <h2>Latest Commits</h2>
                <div>
                    <button id="toggle-app-commits" class="commit-toggle-btn active">App</button>
                    <button id="toggle-game-commits" class="commit-toggle-btn">Games</button>
                </div>
                
                <div id="app-commits-container" class="commit-list-container active">
                    <ul id="commit-list"></ul>
                </div>
                  
                <div id="game-commits-container" class="commit-list-container">
                    <ul id="commit-list-games"></ul>
                </div>
            </section>
        </div>
    </div>

    <div class="divider"></div>

    <script>
    /**
     * Toggles the display of the commit lists and updates the button's active state.
     * @param {string} showId - The ID of the container to show ('app-commits-container' or 'game-commits-container').
     */
    function toggleCommits(showId) {
        const appContainer = document.getElementById('app-commits-container');
        const gameContainer = document.getElementById('game-commits-container');
        const appButton = document.getElementById('toggle-app-commits');
        const gameButton = document.getElementById('toggle-game-commits');

        // Hide both and remove active class from buttons
        appContainer.classList.remove('active');
        gameContainer.classList.remove('active');
        appButton.classList.remove('active');
        gameButton.classList.remove('active');

        // Show the selected container and set its button as active
        if (showId === 'app-commits-container') {
            appContainer.classList.add('active');
            appButton.classList.add('active');
        } else if (showId === 'game-commits-container') {
            gameContainer.classList.add('active');
            gameButton.classList.add('active');
        }
    }

    /** Fetches and displays the latest App Commits */
    async function loadAppCommits() {
      const repo = "explysm/yikegames"; 
      const list = document.getElementById("commit-list");
      list.innerHTML = "<li>Loading App commits...</li>"; 

      try {
        const commitResponse = await fetch(`https://api.github.com/repos/${repo}/commits`);
        const commits = await commitResponse.json();
        
        list.innerHTML = ""; // Clear loading message
        commits.slice(0, 5).forEach(c => {
          const li = document.createElement("li");
          li.innerHTML = `<strong>${c.commit.author.name}</strong>: ${c.commit.message} 
                          <br><small>${new Date(c.commit.author.date).toLocaleString()}</small>`;
          list.appendChild(li);
        });

      } catch (error) {
        console.error("Error fetching GitHub App data:", error);
        list.innerHTML = "<li>Could not load App updates.</li>";
      }
    }

    /** Fetches and displays the latest Game Commits */
    async function loadGameCommits() {
      const repo = "explysm/Games";
      const list = document.getElementById("commit-list-games");
      list.innerHTML = "<li>Loading Game commits...</li>";
      try {
          const response = await fetch(`https://api.github.com/repos/${repo}/commits`);
          const commits = await response.json();
          
          list.innerHTML = ""; // Clear loading message
          commits.slice(0, 5).forEach(c => {
            const li = document.createElement("li");
            li.innerHTML = `<strong>${c.commit.author.name}</strong>: ${c.commit.message} 
                            <br><small>${new Date(c.commit.author.date).toLocaleString()}</small>`;
            list.appendChild(li);
          });
      } catch (error) {
         console.error("Error fetching Game GitHub data:", error);
         list.innerHTML = "<li>Could not load Game updates.</li>";
      }
    }

    // Run the commit fetching and toggle setup once the document structure is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        // 1. Load Data
        loadAppCommits();
        loadGameCommits();
        
        // 2. Setup Toggle Listeners
        document.getElementById('toggle-app-commits').addEventListener('click', () => {
            toggleCommits('app-commits-container');
        });

        document.getElementById('toggle-game-commits').addEventListener('click', () => {
            toggleCommits('game-commits-container');
        });

        // 3. Initialize the view
        // The toggleCommits call is not strictly needed here since we use the 'active' class in HTML, 
        // but it ensures the buttons match the view on load.
        toggleCommits('app-commits-container');
    });


    // --- Existing Fade Transition Script ---
    document.body.classList.add('fade-enter');
    setTimeout(() => {
      document.body.classList.add('fade-enter-active');
    }, 10);

    document.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', function(e) {
        const href = this.getAttribute('href');
        if (href && !href.startsWith('http')) {
          e.preventDefault();
          document.body.classList.remove('fade-enter-active');
          document.body.classList.add('fade-exit-active');
          setTimeout(() => { window.location.href = href; }, 500);
        }
      });
    });
    // --- End Fade Transition Script ---
    </script>
</body>
</html>

